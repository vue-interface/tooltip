{"version":3,"file":"tooltip.mjs","sources":["../src/Popper.ts","../src/Tooltip.vue","../src/TooltipPlugin.ts"],"sourcesContent":["import { createPopper } from '@popperjs/core';\nimport { defineComponent } from 'vue';\n\nexport default defineComponent({\n\n    props: {\n        offset: Array,\n\n        popper: Object,\n\n        show: Boolean,\n\n        target: {\n            type: HTMLElement,\n            required: true\n        },\n\n        title: String,\n\n        placement: String,\n\n        top: Boolean,\n\n        bottom: Boolean,\n\n        left: Boolean,\n\n        right: Boolean,\n    },\n    \n    data() {\n        return {\n            currentShow: false,\n            popperInstance: null\n        };\n    },\n\n    computed: {\n        computedPlacement() {\n            if(this.placement) {\n                return this.placement;\n            }\n\n            if(this.bottom) {\n                return 'bottom';\n            }\n\n            if(this.left) {\n                return 'left';\n            }\n\n            if(this.right) {\n                return 'right';\n            }\n\n            return 'top';\n        },\n        tooltipClasses() {\n            return {\n                show: this.currentShow,\n                [`bs-tooltip-${this.computedPlacement}`]: true\n            };\n        }\n    },\n\n    mounted() {\n        this.popperInstance = createPopper(this.target, this.$el, Object.assign({\n            placement: this.computedPlacement,\n            modifiers: [\n                {\n                    name: 'offset',\n                    options: {\n                        offset: [0, 6]\n                    },\n                },\n                {\n                    name: 'arrow',\n                    options: {\n                        element: this.$refs.arrow,\n                    },\n                },\n            ],\n        }, this.popper));\n\n        this.$nextTick(() => {\n            this.currentShow = this.show;\n        });\n    },\n\n    beforeUnmount() {\n        this.popperInstance && this.popperInstance.destroy();\n    },\n\n    methods: {\n\n        open() {\n            this.currentShow = true;\n        },\n\n        close() {\n            this.currentShow = false;\n        }\n\n    }\n\n});","<script lang=\"ts\">\n// @ts-ignore\nimport Popper from './Popper';\n\nexport default {\n    mixins: [\n        Popper\n    ]\n};\n</script>\n\n<template>\n    <div\n        class=\"tooltip\"\n        :class=\"tooltipClasses\"\n        role=\"tooltip\">\n        <div\n            ref=\"arrow\"\n            class=\"tooltip-arrow\" />\n        <div\n            ref=\"inner\"\n            class=\"tooltip-inner\">\n            <slot>{{ title }}</slot>\n        </div>\n    </div>\n</template>\n\n<style>\n.tooltip:not(.show) {\n    z-index: -1;\n}\n</style>","import type { App } from 'vue';\nimport { h, render } from 'vue';\nimport Tooltip from './Tooltip.vue';\n\nexport default function(app: App, options = {}) {\n\n    const defaultOptions = {\n        delay: undefined,\n        prefix: 'data-tooltip',\n        triggers: {\n            open: ['mouseover:750', 'focus'],\n            close: ['mouseout:1000', 'blur'],\n        }\n    };\n\n    options = Object.assign(defaultOptions, options);\n\n    const prefix = options.prefix.replace(/[-]+$/, '');\n    const prefixRegExp = new RegExp(`^${prefix}\\-`);\n\n    function getAttributes(el: Element): Record<string,any> {\n        return Array.from(el.attributes)\n            .map(a => [a.name, a.value])\n            .filter(([key]) => key === 'title' || key.match(prefixRegExp))\n            .map(([key, value]) => [key.replace(new RegExp(prefixRegExp), ''), value])\n            .reduce((carry, attr) => Object.assign(carry, { [attr[0]]: attr[1] }), {});\n    }\n\n    function createTooltip(target: Element, props: Record<string,any> = {}): Function {\n        const container = document.createElement('template');\n              \n        const vnode = h(Tooltip, Object.assign({\n            target,\n            show: true\n        }, props));\n    \n        render(vnode, container);\n    \n        const [el] = [...container.children];\n    \n        document.body.append(el);\n    \n        return () => {\n            // @ts-ignore\n            vnode.component?.ctx.close();\n    \n            // @todo: Make the animation rate (150) dynamic. Should get value \n            // from the CSS transition duration.\n            setTimeout(() => el.remove(), 150);\n        };\n    }\n\n    function init(target: Element, props = {}) {\n        const properties: Record<string,any> = Object.assign({\n            title: target.getAttribute(prefix)\n        }, props, getAttributes(target));\n\n        // If the properties don't have a title, ignore this target.\n        if(!properties.title || target.hasAttribute(`${prefix}-id`)) {\n            return;\n        }\n\n        // Create a unique \"hash\" to show the node has been initialized.\n        // This prevents double initializing on the same element.\n        const hash = Math.random().toString(36).slice(2, 7);\n        \n        // Create the instance vars.\n        let tooltip: Function|null, timer: number;\n\n        //target.setAttribute(prefix, properties.title);\n        target.setAttribute(`${prefix}-id`, hash);\n        target.removeAttribute('title');\n\n        function open(delay = 0) {\n            clearTimeout(timer);\n\n            if(!tooltip) {\n                timer = setTimeout(() => {\n                    tooltip = createTooltip(target, properties);\n                }, delay);\n            }\n        }\n\n        function close(delay = 0) {\n            clearTimeout(timer);\n\n            if(tooltip) {\n                timer = setTimeout(() => {\n                    tooltip && tooltip();\n                    tooltip = null;\n                }, delay);\n            }       \n        }\n\n        function addEventListener(trigger: string, fn: Function) {\n            const [ event, delayString ] = trigger.split(':');\n\n            target.addEventListener(event, () => fn(Number(delayString || 0)));\n        }\n        \n        options.triggers.open.map(trigger => addEventListener(trigger, open));\n        options.triggers.close.map(trigger => addEventListener(trigger, close));\n    }\n  \n    app.mixin({\n        mounted() {\n            let el = this.$el;\n\n            if(this.$el instanceof Text) {\n                el = this.$el.parentNode;\n            }\n\n            if(el instanceof HTMLElement) {\n                init(el);\n            }\n\n            // Create the tree walker.\n            const walker = document.createTreeWalker(\n                el,\n                NodeFilter.SHOW_ALL,\n                (node: Node) => {\n                    if(!(node instanceof Element)) {\n                        return NodeFilter.FILTER_REJECT;\n                    }\n                    \n                    return NodeFilter.FILTER_ACCEPT;\n                }\n            );\n\n            // Step through and alert all child nodes\n            while(walker.nextNode()) {\n                if(walker.currentNode instanceof Element) {\n                    init(<Element> walker.currentNode);\n                }\n            }\n        }\n    });\n\n    app.directive('tooltip', (target, binding) => init(\n        target, Object.assign({}, binding.modifiers, binding.value)\n    ));\n}"],"names":["Popper","defineComponent","createPopper","_sfc_main","_hoisted_1","_hoisted_2","_sfc_render","_ctx","_cache","$props","$setup","$data","$options","_openBlock","_createElementBlock","_normalizeClass","_createElementVNode","_renderSlot","TooltipPlugin","app","options","prefix","prefixRegExp","getAttributes","el","a","key","value","carry","attr","createTooltip","target","props","container","vnode","h","Tooltip","render","_a","init","properties","hash","tooltip","timer","open","delay","close","addEventListener","trigger","fn","event","delayString","walker","node","binding"],"mappings":"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"}